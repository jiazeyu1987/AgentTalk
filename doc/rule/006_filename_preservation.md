# 文件名保持原样

**原则ID**: PR-006
**来源文档**: file_transfer_mechanism.md
**类别**: 文件管理

---

## 原则描述

通过plan_id目录隔离避免同名冲突，不需要修改文件名。所有文件在传递过程中保持原有文件名不变。

## 实现方式

- **目录隔离**: 通过plan_id子目录隔离不同plan的文件
- **文件名不变**: 配置文件、文档文件、代码文件等都保持原有名称
- **避免冲突**: 不同plan可以有同名文件，因为它们在不同的plan_id目录下

当同一plan内需要多版本/多次投递且仍要保持文件名不变时，推荐使用“消息目录”包装而不是改名：

- 发送方写入：`outbox/<plan_id>/<message_id>/<original_filename>`
- 同时写入：`outbox/<plan_id>/<message_id>/message.meta.json`（包含message_id、sha256、type等，见PR-001）
- 接收方落盘：`inbox/<plan_id>/<message_id>/<original_filename>`

这样既能保持原始文件名不变，又能避免同一plan内的覆盖与歧义，并天然支持去重/审计。

## 历史记录

系统维护完整的历史记录：

- **已发送文件**: `outbox/.sent/<plan_id>/` 保存所有已发送文件的目录结构
- **已处理消息**: `inbox/.processed/<plan_id>/` 保存所有已处理消息的目录结构
- **定期归档**: 超过30天的记录移动到 `.archive/` 目录

## 关键要点

- **无需改名**: 不需要为避免冲突而修改文件名
- **自然命名**: 文件名可以保持其自然的、有意义的名称
- **易于理解**: 文件名直接反映内容，不需要额外的编码规则
- **便于调试**: 文件名保持不变，便于日志追踪和调试

## 示例

不同plan可以有同名文件：
- `plan_a3f5b2c8/config.json`
- `plan_b4g6c9d1/config.json`

由于在不同的plan_id目录下，不会产生冲突。

---

**最后更新**: 2025-01-08
