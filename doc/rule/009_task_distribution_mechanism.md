# 任务分配机制

**原则ID**: PR-009
**来源文档**: agent_task_distribution.md
**类别**: 核心机制

---

## 原则描述

GM（总经理）Agent通过LLM驱动将复杂任务分配给合适的Agent，每个Agent负责独立的一块工作，任务之间不重叠，不递归分配。

## visibility_list文件夹

GM Agent有一个visibility_list文件夹，里面包含各个Agent的描述文件。

### 文件夹结构

visibility_list文件夹位于GM Agent目录下，包含若干个描述文件。

### 描述文件内容

每个文件描述一个Agent，包含以下信息：
- Agent ID：Agent的唯一标识符
- 名字：Agent的可读名称
- 拥有的技能：Agent能够处理的工作类型
- 需要的输入：Agent完成任务所需的输入类型
- 可以的输出：Agent完成任务后能够提供的输出类型

## 任务分配流程

### 1. 读取visibility_list

GM读取visibility_list文件夹中所有Agent的描述文件，了解每个Agent的能力范围、输入和输出要求。

### 2. 分析原始任务

GM使用LLM分析用户提交的原始任务，理解任务的目标、范围和要求。

### 3. 任务分解

GM通过LLM将原始任务分解为多个子任务，分解时遵循以下原则：
- 不重叠：每个子任务负责独立的一块工作，子任务之间没有职责重叠
- 可分配：每个子任务都可以分配给visibility_list中的一个Agent
- 明确边界：每个子任务有清晰的输入和输出定义

### 4. Agent选择

为每个子任务选择最合适的Agent：
- 根据Agent的技能匹配度
- 检查Agent的输入要求是否满足
- 确认Agent的输出符合后续任务的需求

### 5. 不递归分配

任务分配只有一层：
- GM将任务分配给各个Agent
- 被分配的Agent直接执行任务，不继续向下分配
- 保持架构简单，避免多层嵌套的复杂性

## 输出格式

任务分配完成后，GM生成两类文件，放到outbox等待分配给其他Agent。

### DAG图

DAG（有向无环图）描述子任务之间的依赖关系：
- 节点：每个子任务
- 边：子任务之间的依赖关系
- 通过DAG图可以清晰地看到哪些任务可以并行执行，哪些任务必须串行执行

### 命令文件

为每个Agent生成执行命令，包含：
- 任务描述
- 输入文件列表
- 输出文件要求
- 完成条件和标准

## 关键特性

### LLM驱动

整个任务分配过程由LLM驱动：
- 理解任务意图
- 分析任务复杂度
- 进行合理分解
- 选择合适的Agent

### 任务独立性

每个子任务独立：
- 不同Agent负责不同的任务
- 避免任务重叠导致的冲突
- 减少Agent之间的协调成本

### 一层分配

只有一层任务分配：
- GM直接分配给执行Agent
- 不存在中间管理层
- 简化系统架构

### 依赖关系清晰

通过DAG图明确表达：
- 哪些任务可以并行
- 哪些任务有先后顺序
- 如何协调多个Agent的工作

## 工作示例

GM收到任务"开发一个电商网站"后：

1. 读取visibility_list，发现有产品经理、数据库专家、后端开发者、前端开发者等Agent
2. 通过LLM分析任务，分解为：需求分析、数据库设计、后端开发、前端开发
3. 为每个子任务分配合适的Agent：
   - 需求分析 → 产品经理
   - 数据库设计 → 数据库专家
   - 后端开发 → 后端开发者
   - 前端开发 → 前端开发者
4. 生成DAG图，表达依赖关系（如：后端开发依赖需求分析和数据库设计）
5. 生成命令文件，放到outbox等待分配给各Agent

## 与其他原则的配合

### 与PR-001（inbox/outbox文件传递）配合

- 任务分配结果通过outbox发送
- 各Agent通过inbox接收分配的任务

### 与PR-007（统一的执行命令）配合

- 生成的命令文件遵循统一的执行命令格式
- 各Agent使用相同的命令处理机制

### 与PR-008（Agent文件夹结构）配合

- visibility_list文件夹是Agent文件夹结构的一部分
- 遵循统一的文件夹组织原则

## 关键要点

- **LLM驱动**: 通过LLM理解任务并智能分配
- **visibility_list**: 明确GM可以看到和分配的Agent
- **不重叠**: 每个子任务独立，避免冲突
- **一层分配**: 不递归，保持架构简单
- **DAG图**: 清晰表达任务依赖关系
- **可扩展**: 可以通过添加新的Agent描述文件来扩展系统

---

**最后更新**: 2025-01-08
