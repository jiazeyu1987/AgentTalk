# é˜²æ­¢AIå¹»è§‰ä¸è¾“å…¥éªŒè¯æœºåˆ¶

## æ–‡æ¡£ä¿¡æ¯

- **æ–‡æ¡£åç§°**ï¼šé˜²æ­¢AIå¹»è§‰ä¸è¾“å…¥éªŒè¯æœºåˆ¶ï¼ˆHallucination Prevention and Input Validationï¼‰
- **ç‰ˆæœ¬**ï¼šv1.0
- **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-06
- **ç›®çš„**ï¼šè§£å†³AI Agentå®¹æ˜“ç¼–é€ èµ„æ–™çš„é—®é¢˜ï¼Œæ˜ç¡®ç”Ÿæˆä¸ç­‰å¾…çš„è¾¹ç•Œ

---

## ä¸€ã€é—®é¢˜å®šä¹‰

### 1.1 æ ¸å¿ƒé—®é¢˜

**ç”¨æˆ·é—®é¢˜**ï¼š"AIå®¹æ˜“è‡ªå·±ç¼–èµ„æ–™ï¼Œå®ƒå¦‚ä½•åˆ¤å®šä¸€ä¸ªèµ„æ–™æ˜¯è¦è‡ªå·±ç”Ÿæˆï¼Œè¿˜æ˜¯ç­‰å¾…å¤–éƒ¨è¾“å…¥ï¼Ÿ"

**é—®é¢˜æœ¬è´¨**ï¼š
- LLMçš„ç”Ÿæˆç‰¹æ€§å¯¼è‡´å…¶å€¾å‘äº"å›ç­”é—®é¢˜"è€Œé"æ‰¿è®¤ä¸çŸ¥é“"
- Agentå¯èƒ½è™šæ„æ•°æ®ã€æ–‡æ¡£ã€äº‹å®ï¼Œå¯¼è‡´äº§å‡ºä¸å¯é 
- éœ€è¦æ˜ç¡®åŒºåˆ†"å¯ä»¥ç”¨çŸ¥è¯†ç”Ÿæˆ"å’Œ"å¿…é¡»ç­‰å¾…çœŸå®æ•°æ®"çš„è¾¹ç•Œ

### 1.2 é—®é¢˜å½±å“

**ä¸¥é‡æ€§**ï¼šâš ï¸ **è‡´å‘½çº§**
- è™šå‡æ•°æ®å¯èƒ½å¯¼è‡´é”™è¯¯å†³ç­–
- ä¸å¯é çš„äº§å‡ºæ‘§æ¯ç”¨æˆ·ä¿¡ä»»
- è¿èƒŒ"ä¸“ä¸šæ€§"äº§å“ä»·å€¼ä¸»å¼ 

**å®é™…åœºæ™¯**ï¼š
```
åœºæ™¯ï¼šå¼€å‘ç”µå•†ç½‘ç«™
ç”¨æˆ·ï¼šéœ€è¦æ”¯ä»˜åŠŸèƒ½
Agentï¼ˆå¹»è§‰ï¼‰ï¼šç”Ÿæˆæ”¯ä»˜å®APIæ–‡æ¡£ï¼ˆè™šæ„çš„ï¼‰
ç»“æœï¼šå¼€å‘å¤±è´¥ï¼Œæµªè´¹æ—¶é—´

æ­£ç¡®åšæ³•ï¼š
Agentï¼šæ£€æµ‹åˆ°éœ€è¦æ”¯ä»˜åŠŸèƒ½ï¼Œè¯†åˆ«ä¸º"å¤–éƒ¨é›†æˆ"
Agentï¼šå£°æ˜éœ€è¦"çœŸå®çš„æ”¯ä»˜å®APIæ–‡æ¡£"
Agentï¼šç­‰å¾…å¤–éƒ¨è¾“å…¥ï¼Œä¸è™šæ„å†…å®¹
```

---

## äºŒã€è§£å†³åŸåˆ™

### åŸåˆ™1ï¼šæ˜¾å¼å£°æ˜è¾“å…¥éœ€æ±‚ âœ…

**è®¾è®¡**ï¼šAgentåœ¨æ‰§è¡Œä»»åŠ¡å‰å¿…é¡»**æ˜¾å¼å£°æ˜**æ‰€æœ‰è¾“å…¥éœ€æ±‚

**å®ç°æœºåˆ¶**ï¼š
```json
{
  "task_id": "task_001",
  "input_requirements": [
    {
      "input_id": "alipay_api_doc",
      "urgency": "BLOCKING",
      "source": "EXTERNAL",  // å…³é”®ï¼šå£°æ˜æ¥æº
      "reason": "æ”¯ä»˜æ¥å£æ–‡æ¡£éœ€è¦ä»æ”¯ä»˜å®å®˜æ–¹è·å–ï¼Œæ— æ³•ç”Ÿæˆ",
      "expected_format": "PDF or Markdown",
      "validation_criteria": [
        "åŒ…å«API endpoint URL",
        "åŒ…å«è®¤è¯æ–¹å¼",
        "åŒ…å«ç¤ºä¾‹ä»£ç "
      ]
    }
  ]
}
```

**å…³é”®ç‚¹**ï¼š
- `source`: `EXTERNAL`ï¼ˆå¤–éƒ¨ï¼‰ vs `INTERNAL`ï¼ˆå†…éƒ¨ç”Ÿæˆï¼‰
- Agentå¿…é¡»æ˜ç¡®æ ‡æ³¨æ¯ä¸ªè¾“å…¥çš„æ¥æºç±»å‹
- åªæœ‰`INTERNAL`ç±»å‹çš„æ•°æ®æ‰èƒ½ç”±LLMç”Ÿæˆ

---

### åŸåˆ™2ï¼šåˆ†ç±»å†³ç­–æ ‘ âœ…

**è®¾è®¡**ï¼šAgentä½¿ç”¨å†³ç­–æ ‘åˆ¤æ–­è¾“å…¥ç±»å‹

**å†³ç­–æµç¨‹**ï¼š

```
Agentæ”¶åˆ°ä»»åŠ¡
  â†“
åˆ†è§£ä»»åŠ¡ï¼Œè¯†åˆ«æ‰€éœ€ä¿¡æ¯
  â†“
éå†æ¯ä¸ªä¿¡æ¯é¡¹ï¼Œå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q1: è¿™ä¸ªä¿¡æ¯æ˜¯å¦å±äº"é€šç”¨çŸ¥è¯†"ï¼Ÿ         â”‚
â”‚     - å†å²äº‹å®ã€ç§‘å­¦åŸç†ã€ç¼–ç¨‹æ¦‚å¿µ      â”‚
â”‚     - è®¾è®¡æ¨¡å¼ã€ç®—æ³•é€»è¾‘                â”‚
â”‚     - é€šç”¨è¡Œä¸šæ ‡å‡†                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ YES
ã€INTERNALã€‘å¯ä»¥ä½¿ç”¨LLMçŸ¥è¯†ç”Ÿæˆ
  â†’ æ ‡æ³¨ source="INTERNAL"
  â†’ ç”Ÿæˆå†…å®¹

  â†“ NO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q2: è¿™ä¸ªä¿¡æ¯æ˜¯å¦å±äº"é¡¹ç›®/ä¸šåŠ¡ç‰¹å®š"ï¼Ÿ    â”‚
â”‚     - å…¬å¸æ”¿ç­–ã€ä¸šåŠ¡è§„åˆ™                â”‚
â”‚     - ç”¨æˆ·æ•°æ®ã€å†å²è®°å½•                â”‚
â”‚     - ç¬¬ä¸‰æ–¹APIå¯†é’¥ã€é…ç½®ä¿¡æ¯           â”‚
â”‚     - è®¾è®¡é£æ ¼ã€å“ç‰Œè§„èŒƒ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ YES
ã€EXTERNALã€‘å¿…é¡»ç­‰å¾…å¤–éƒ¨è¾“å…¥
  â†’ æ ‡æ³¨ source="EXTERNAL"
  â†’ å£°æ˜è¾“å…¥éœ€æ±‚
  â†’ è¿›å…¥ BLOCKED_WAITING_INPUT çŠ¶æ€

  â†“ NO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q3: è¿™ä¸ªä¿¡æ¯æ˜¯å¦å±äº"å®æ—¶/åŠ¨æ€æ•°æ®"ï¼Ÿ    â”‚
â”‚     - å½“å‰æ—¶é—´ã€å¤©æ°”                    â”‚
â”‚     - å®æ—¶ä»·æ ¼ã€åº“å­˜                    â”‚
â”‚     - ç”¨æˆ·è¡Œä¸ºæ•°æ®                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ YES
ã€EXTERNALã€‘å¿…é¡»ä»å¤–éƒ¨ç³»ç»Ÿè·å–
  â†’ æ ‡æ³¨ source="EXTERNAL"
  â†’ è°ƒç”¨å¯¹åº”çš„skillï¼ˆçˆ¬è™«ã€APIè°ƒç”¨ç­‰ï¼‰
  â†’ æˆ–ç­‰å¾…å¤–éƒ¨è¾“å…¥
```

**åˆ†ç±»è¡¨**ï¼š

| ä¿¡æ¯ç±»å‹ | æ¥æº | ç¤ºä¾‹ | å¦‚ä½•å¤„ç† |
|---------|------|------|---------|
| **é€šç”¨ç¼–ç¨‹çŸ¥è¯†** | INTERNAL | Pythonè¯­æ³•ã€æ•°æ®åº“èŒƒå¼ | LLMç”Ÿæˆ |
| **è¡Œä¸šæœ€ä½³å®è·µ** | INTERNAL | REST APIè®¾è®¡åŸåˆ™ | LLMç”Ÿæˆ |
| **ç§‘å­¦/æ•°å­¦äº‹å®** | INTERNAL | Ï€çš„å€¼ã€æ’åºç®—æ³•å¤æ‚åº¦ | LLMç”Ÿæˆ |
| **é¡¹ç›®ç‰¹å®šè§„åˆ™** | EXTERNAL | å…¬å¸ä»£ç è§„èŒƒã€ä¸šåŠ¡è§„åˆ™ | ç­‰å¾…è¾“å…¥ |
| **ç”¨æˆ·/ä¸šåŠ¡æ•°æ®** | EXTERNAL | ç”¨æˆ·åˆ—è¡¨ã€äº§å“ä»·æ ¼ | ç­‰å¾…è¾“å…¥ |
| **ç¬¬ä¸‰æ–¹å‡­è¯** | EXTERNAL | API Keyã€å¯†é’¥ | ç­‰å¾…è¾“å…¥ |
| **å®æ—¶æ•°æ®** | EXTERNAL | å½“å‰æ—¥æœŸã€è‚¡ç¥¨ä»·æ ¼ | Skillè·å–æˆ–ç­‰å¾… |
| **è®¾è®¡åå¥½** | EXTERNAL | Logoã€é¢œè‰²ä¸»é¢˜ | ç­‰å¾…è¾“å…¥ |
| **å†å²è®°å½•** | EXTERNAL | ä»¥å¾€å†³ç­–ã€ä¼šè®®çºªè¦ | ç­‰å¾…è¾“å…¥ |

---

### åŸåˆ™3ï¼šä¸¥æ ¼çš„æç¤ºè¯å·¥ç¨‹ âœ…

**è®¾è®¡**ï¼šåœ¨Agentçš„æç¤ºè¯ä¸­æ˜ç¡®çº¦æŸè¡Œä¸º

**Agentæç¤ºè¯æ¨¡æ¿**ï¼š

```markdown
# è§’è‰²ï¼šXXXä¸“å®¶

## æ ¸å¿ƒåŸåˆ™

### âš ï¸ åå¹»è§‰çº¦æŸï¼ˆCRITICALï¼‰

ä½ **ä¸¥æ ¼ç¦æ­¢**ç¼–é€ ã€è™šæ„ã€çŒœæµ‹ä»¥ä¸‹å†…å®¹ï¼š

1. **é¡¹ç›®ç‰¹å®šä¿¡æ¯**
   - âŒ ä¸èƒ½è™šæ„å…¬å¸åç§°ã€å‘˜å·¥ä¿¡æ¯
   - âŒ ä¸èƒ½ç¼–é€ ä¸šåŠ¡è§„åˆ™ã€æµç¨‹
   - âŒ ä¸èƒ½å‡è®¾äº§å“ä»·æ ¼ã€è§„æ ¼
   - âŒ ä¸èƒ½ç”Ÿæˆä¸å­˜åœ¨çš„é…ç½®ä¿¡æ¯

2. **ç¬¬ä¸‰æ–¹é›†æˆä¿¡æ¯**
   - âŒ ä¸èƒ½è™šæ„APIæ–‡æ¡£å†…å®¹
   - âŒ ä¸èƒ½ç¼–é€ SDKä½¿ç”¨æ–¹æ³•
   - âŒ ä¸èƒ½å‡è®¾API Keyã€å¯†é’¥
   - âŒ ä¸èƒ½ç”Ÿæˆå‡çš„endpoint URL

3. **å®æ—¶/åŠ¨æ€æ•°æ®**
   - âŒ ä¸èƒ½ç¼–é€ å½“å‰æ—¶é—´ã€æ—¥æœŸ
   - âŒ ä¸èƒ½å‡è®¾å®æ—¶ä»·æ ¼ã€åº“å­˜
   - âŒ ä¸èƒ½è™šæ„ç”¨æˆ·è¡Œä¸ºæ•°æ®

### âœ… ä½ å¯ä»¥ç”Ÿæˆçš„å†…å®¹

ä»¥ä¸‹å†…å®¹å¯ä»¥ä½¿ç”¨ä½ çš„å†…éƒ¨çŸ¥è¯†ç”Ÿæˆï¼š

1. **é€šç”¨æŠ€æœ¯çŸ¥è¯†**
   - âœ… ç¼–ç¨‹è¯­è¨€è¯­æ³•ã€æ¡†æ¶ä½¿ç”¨æ–¹æ³•
   - âœ… ç®—æ³•ã€æ•°æ®ç»“æ„ã€è®¾è®¡æ¨¡å¼
   - âœ… ç³»ç»Ÿæ¶æ„åŸåˆ™ã€æœ€ä½³å®è·µ

2. **è¡Œä¸šé€šç”¨è§„èŒƒ**
   - âœ… REST APIè®¾è®¡åŸåˆ™
   - âœ… æ•°æ®åº“è®¾è®¡èŒƒå¼
   - âœ… å®‰å…¨ç¼–ç æ ‡å‡†

3. **æ¨¡æ¿å’Œç»“æ„**
   - âœ… ä»£ç æ¨¡æ¿ã€æ–‡æ¡£ç»“æ„
   - âœ… é€šç”¨é…ç½®æ–‡ä»¶æ ¼å¼
   - âœ… æµ‹è¯•ç”¨ä¾‹æ¡†æ¶

### ğŸ›¡ï¸ è¾“å…¥éœ€æ±‚å£°æ˜æœºåˆ¶

å½“ä»»åŠ¡éœ€è¦é¡¹ç›®ç‰¹å®šæˆ–å¤–éƒ¨ä¿¡æ¯æ—¶ï¼Œä½ **å¿…é¡»**ï¼š

1. **è¯†åˆ«éœ€æ±‚**ï¼šåœ¨å¼€å§‹æ‰§è¡Œå‰ï¼Œæ‰«æä»»åŠ¡æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯
2. **åˆ†ç±»åˆ¤æ–­**ï¼šä½¿ç”¨å†³ç­–æ ‘åˆ¤æ–­æ¯é¡¹ä¿¡æ¯çš„æ¥æºç±»å‹
3. **æ˜¾å¼å£°æ˜**ï¼šä¸ºæ‰€æœ‰`EXTERNAL`ç±»å‹çš„ä¿¡æ¯å£°æ˜è¾“å…¥éœ€æ±‚
4. **ç­‰å¾…è¾“å…¥**ï¼šåœ¨æœªæ”¶åˆ°çœŸå®è¾“å…¥å‰ï¼Œ**ç¦æ­¢**ç”Ÿæˆè™šå‡å†…å®¹

### ğŸ“‹ è¾“å…¥éœ€æ±‚å£°æ˜æ ¼å¼

```json
{
  "input_requirements": [
    {
      "input_id": "å”¯ä¸€æ ‡è¯†",
      "description": "éœ€è¦çš„å…·ä½“å†…å®¹",
      "source": "EXTERNAL | INTERNAL",
      "urgency": "BLOCKING | OPTIONAL",
      "reason": "ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¾“å…¥",
      "expected_format": "æœŸæœ›çš„æ ¼å¼",
      "validation_criteria": ["éªŒè¯æ ‡å‡†1", "éªŒè¯æ ‡å‡†2"]
    }
  ]
}
```

### ğŸš¨ é‡åˆ°ä¸ç¡®å®šæ€§æ—¶çš„è¡Œä¸º

å½“ä½ ä¸ç¡®å®šæŸä¸ªä¿¡æ¯æ˜¯åº”è¯¥ç”Ÿæˆè¿˜æ˜¯ç­‰å¾…æ—¶ï¼š

1. **ä¿å®ˆåŸåˆ™**ï¼šå€¾å‘äºç­‰å¾…å¤–éƒ¨è¾“å…¥
2. **æ˜ç¡®è¯´æ˜**ï¼šåœ¨è¾“å‡ºä¸­æ ‡æ³¨"ä»¥ä¸‹å†…å®¹åŸºäºå‡è®¾ï¼Œéœ€è¦ç¡®è®¤"
3. **éƒ¨åˆ†æ‰§è¡Œ**ï¼šå¦‚æœå¯ä»¥ï¼Œå…ˆå®Œæˆå¯ä»¥ç¡®å®šçš„éƒ¨åˆ†ï¼Œå…¶ä»–éƒ¨åˆ†ç­‰å¾…è¾“å…¥

---

## ç¤ºä¾‹åœºæ™¯

### åœºæ™¯1ï¼šå¼€å‘ç”¨æˆ·ç™»å½•åŠŸèƒ½

**ä»»åŠ¡**ï¼š"å¼€å‘ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼Œæ”¯æŒé‚®ç®±å’Œæ‰‹æœºå·ç™»å½•"

**Agentåˆ†æ**ï¼š

```
æ­¥éª¤1ï¼šåˆ†è§£ä»»åŠ¡
  - éœ€æ±‚åˆ†æ
  - æ•°æ®åº“è®¾è®¡
  - APIè®¾è®¡
  - å‰ç«¯é¡µé¢è®¾è®¡
  - æµ‹è¯•ç”¨ä¾‹ç¼–å†™

æ­¥éª¤2ï¼šè¯†åˆ«æ‰€éœ€ä¿¡æ¯
  - ç™»å½•æµç¨‹é€»è¾‘ â†’ INTERNALï¼ˆé€šç”¨çŸ¥è¯†ï¼‰
  - å¯†ç åŠ å¯†æ–¹æ³• â†’ INTERNALï¼ˆæœ€ä½³å®è·µï¼‰
  - å…¬å¸çš„ç”¨æˆ·è¡¨ç»“æ„ â†’ EXTERNALï¼ˆé¡¹ç›®ç‰¹å®šï¼‰
  - å‰ç«¯UIé£æ ¼ â†’ EXTERNALï¼ˆå“ç‰Œè§„èŒƒï¼‰
  - Sessioné…ç½® â†’ EXTERNALï¼ˆç³»ç»Ÿé…ç½®ï¼‰

æ­¥éª¤3ï¼šå£°æ˜è¾“å…¥éœ€æ±‚
{
  "input_requirements": [
    {
      "input_id": "user_table_schema",
      "description": "ç”¨æˆ·è¡¨çš„ç»“æ„å®šä¹‰",
      "source": "EXTERNAL",
      "urgency": "BLOCKING",
      "reason": "éœ€è¦äº†è§£ç°æœ‰ç”¨æˆ·è¡¨å­—æ®µï¼Œä»¥ä¾¿è®¾è®¡ç™»å½•é€»è¾‘",
      "expected_format": "SQL DDL or Markdown table"
    },
    {
      "input_id": "ui_style_guide",
      "description": "å‰ç«¯UIè®¾è®¡è§„èŒƒ",
      "source": "EXTERNAL",
      "urgency": "OPTIONAL",
      "reason": "ç”¨äºè®¾è®¡ç™»å½•é¡µé¢çš„è§†è§‰é£æ ¼",
      "expected_format": "CSS or Design doc"
    },
    {
      "input_id": "session_config",
      "description": "Sessioné…ç½®å‚æ•°",
      "source": "EXTERNAL",
      "urgency": "BLOCKING",
      "reason": "éœ€è¦çŸ¥é“sessionè¿‡æœŸæ—¶é—´ã€å­˜å‚¨æ–¹å¼ç­‰",
      "expected_format": "JSON or Config file"
    }
  ]
}

æ­¥éª¤4ï¼šç­‰å¾…è¾“å…¥
  â†’ è¿›å…¥ BLOCKED_WAITING_INPUT çŠ¶æ€
  â†’ ç”Ÿæˆ workspace/required_docs/task_001.md

æ­¥éª¤5ï¼šæ”¶åˆ°è¾“å…¥åæ‰§è¡Œ
  â†’ ä½¿ç”¨INTERNALçŸ¥è¯†ç”Ÿæˆç™»å½•æµç¨‹
  â†’ ä½¿ç”¨EXTERNALè¾“å…¥å®šåˆ¶å…·ä½“å®ç°
```

**Agentä¸ä¼šåšçš„**ï¼š
- âŒ è™šæ„ç”¨æˆ·è¡¨æœ‰å“ªå‡ ä¸ªå­—æ®µ
- âŒ å‡è®¾å…¬å¸çš„é¢œè‰²ä¸»é¢˜
- âŒ ç¼–é€ Sessioné…ç½®å‚æ•°

---

### åœºæ™¯2ï¼šç”Ÿæˆæ•°æ®åº“è®¾è®¡æ–‡æ¡£

**ä»»åŠ¡**ï¼š"è®¾è®¡ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„æ•°æ®åº“"

**Agentåˆ†æ**ï¼š

```
å¯ä»¥ç”Ÿæˆï¼ˆINTERNALï¼‰ï¼š
  âœ… é€šç”¨è¡¨ç»“æ„ï¼ˆç”¨æˆ·ã€å•†å“ã€è®¢å•ï¼‰
  âœ… å…³ç³»è®¾è®¡åŸåˆ™ï¼ˆå¤–é”®ã€ç´¢å¼•ï¼‰
  âœ… èŒƒå¼è§„èŒƒã€æœ€ä½³å®è·µ

ä¸èƒ½ç”Ÿæˆï¼ˆEXTERNALï¼‰ï¼š
  âŒ å…·ä½“å­—æ®µé•¿åº¦ï¼ˆvarchar(50) vs varchar(100)ï¼‰
  âŒ å…·ä½“ç´¢å¼•ç­–ç•¥ï¼ˆå–å†³äºæŸ¥è¯¢æ¨¡å¼ï¼‰
  âŒ åˆ†åº“åˆ†è¡¨è§„åˆ™ï¼ˆå–å†³äºæ•°æ®é‡çº§ï¼‰
  âŒ å¤‡ä»½ç­–ç•¥ï¼ˆå–å†³äºä¸šåŠ¡SLAï¼‰

è¡ŒåŠ¨ï¼š
  â†’ ç”Ÿæˆé€šç”¨çš„æ•°æ®åº“è®¾è®¡æ¡†æ¶
  â†’ å£°æ˜éœ€è¦è¾“å…¥ï¼šä¸šåŠ¡è§„æ¨¡ã€æŸ¥è¯¢æ¨¡å¼ã€SLAè¦æ±‚
  â†’ ç­‰å¾…å¤–éƒ¨è¾“å…¥ä»¥å®Œå–„è®¾è®¡
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```markdown
# ç”µå•†ç³»ç»Ÿæ•°æ®åº“è®¾è®¡ï¼ˆåˆç¨¿ï¼‰

## âš ï¸ è¯´æ˜
æœ¬æ–‡æ¡£åŸºäºé€šç”¨æœ€ä½³å®è·µç”Ÿæˆã€‚ä»¥ä¸‹éƒ¨åˆ†éœ€è¦ä¸šåŠ¡ä¿¡æ¯è¡¥å……ï¼š
- [ ] å…·ä½“å­—æ®µé•¿åº¦ï¼ˆéœ€è¦ä¸šåŠ¡é¢„æœŸï¼‰
- [ ] ç´¢å¼•ç­–ç•¥ï¼ˆéœ€è¦æŸ¥è¯¢æ¨¡å¼ï¼‰
- [ ] åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆï¼ˆéœ€è¦æ•°æ®é‡çº§é¢„ä¼°ï¼‰

## å·²å®Œæˆçš„é€šç”¨è®¾è®¡

### 1. æ ¸å¿ƒè¡¨ç»“æ„ï¼ˆINTERNAL - åŸºäºæœ€ä½³å®è·µï¼‰

#### ç”¨æˆ·è¡¨ï¼ˆusersï¼‰
```sql
CREATE TABLE users (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(?) COMMENT 'é•¿åº¦å¾…å®š',
  email VARCHAR(?) COMMENT 'é•¿åº¦å¾…å®š',
  password_hash VARCHAR(255) NOT NULL,  -- é€šç”¨æ ‡å‡†
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- é€šç”¨æ ‡å‡†
  ...
);
```
```

---

## ä¸‰ã€éªŒè¯æœºåˆ¶

### 3.1 è¾“å…¥éªŒè¯ âœ…

**è®¾è®¡**ï¼šAgentæ”¶åˆ°å¤–éƒ¨è¾“å…¥åï¼Œè¿›è¡Œä¸¥æ ¼éªŒè¯

**éªŒè¯å±‚æ¬¡**ï¼š

```
Level 1: æ ¼å¼éªŒè¯
  â†’ æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆPDF, JSON, SQLç­‰ï¼‰
  â†’ æ£€æŸ¥åŸºæœ¬ç»“æ„æ˜¯å¦å®Œæ•´

Level 2: å†…å®¹å®Œæ•´æ€§éªŒè¯
  â†’ æ£€æŸ¥æ˜¯å¦åŒ…å«å¿…éœ€çš„å­—æ®µ
  â†’ æ£€æŸ¥å…³é”®ä¿¡æ¯æ˜¯å¦å­˜åœ¨

Level 3: é€»è¾‘ä¸€è‡´æ€§éªŒè¯
  â†’ æ£€æŸ¥ä¿¡æ¯æ˜¯å¦è‡ªç›¸çŸ›ç›¾
  â†’ æ£€æŸ¥ä¿¡æ¯æ˜¯å¦åˆç†ï¼ˆå¦‚æ—¥æœŸã€æ•°å€¼èŒƒå›´ï¼‰

Level 4: äº¤å‰éªŒè¯ï¼ˆå¯é€‰ï¼‰
  â†’ å¦‚æœæœ‰å¤šä¸ªæ¥æºï¼Œäº¤å‰éªŒè¯ä¸€è‡´æ€§
  â†’ å¦‚æœæœ‰å†å²æ•°æ®ï¼Œæ£€æŸ¥å…¼å®¹æ€§
```

**éªŒè¯ä»£ç ç¤ºä¾‹**ï¼š

```python
class InputValidator:
    def validate_input(self, input_data, requirement):
        """
        éªŒè¯è¾“å…¥æ•°æ®æ˜¯å¦æ»¡è¶³è¦æ±‚

        Args:
            input_data: ç”¨æˆ·æä¾›çš„è¾“å…¥æ•°æ®
            requirement: input_requirementå®šä¹‰

        Returns:
            {
                "valid": True/False,
                "errors": ["é”™è¯¯1", "é”™è¯¯2"],
                "warnings": ["è­¦å‘Š1"]
            }
        """
        errors = []
        warnings = []

        # Level 1: æ ¼å¼éªŒè¯
        if requirement.expected_format == "JSON":
            if not self.is_valid_json(input_data):
                errors.append("è¾“å…¥ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼")
        elif requirement.expected_format == "SQL":
            if not self.is_valid_sql(input_data):
                errors.append("è¾“å…¥ä¸æ˜¯æœ‰æ•ˆçš„SQLè¯­å¥")

        # Level 2: å†…å®¹å®Œæ•´æ€§éªŒè¯
        for criteria in requirement.validation_criteria:
            if not self.check_criteria(input_data, criteria):
                errors.append(f"ç¼ºå°‘å¿…è¦å†…å®¹ï¼š{criteria}")

        # Level 3: é€»è¾‘ä¸€è‡´æ€§éªŒè¯
        consistency_result = self.check_consistency(input_data)
        if not consistency_result["consistent"]:
            warnings.extend(consistency_result["warnings"])

        return {
            "valid": len(errors) == 0,
            "errors": errors,
            "warnings": warnings
        }

    def check_criteria(self, data, criteria):
        """æ£€æŸ¥ç‰¹å®šéªŒè¯æ ‡å‡†"""
        if "API endpoint" in criteria:
            return self.contains_api_endpoint(data)
        if "è®¤è¯æ–¹å¼" in criteria:
            return self.contains_auth_method(data)
        # ... æ›´å¤šéªŒè¯è§„åˆ™
        return True
```

**éªŒè¯å¤±è´¥çš„å¤„ç†**ï¼š

```
Agentæ”¶åˆ°è¾“å…¥
  â†“
æ‰§è¡ŒéªŒè¯
  â†“
éªŒè¯é€šè¿‡ï¼Ÿ
  â†“ YES
  â†’ æ ‡è®°è¾“å…¥ä¸º VALIDATED
  â†’ å¼€å§‹æ‰§è¡Œä»»åŠ¡

  â†“ NO
  â†’ ç”Ÿæˆ validation_report.json
  â†’ å‘é€ VALIDATION_FAILED æ¶ˆæ¯ç»™ç”¨æˆ·
  â†’ ä¿æŒåœ¨ BLOCKED_WAITING_INPUT çŠ¶æ€
  â†’ æç¤ºå…·ä½“é—®é¢˜å’Œä¿®æ­£å»ºè®®
```

**éªŒè¯æŠ¥å‘Šç¤ºä¾‹**ï¼š

```json
{
  "input_id": "alipay_api_doc",
  "validation_result": "FAILED",
  "errors": [
    "æ–‡æ¡£ä¸­ç¼ºå°‘API endpoint URL",
    "æ–‡æ¡£ä¸­æ²¡æœ‰è¯´æ˜è®¤è¯æ–¹å¼"
  ],
  "warnings": [
    "ç¤ºä¾‹ä»£ç ä¸å®Œæ•´"
  ],
  "suggestions": [
    "è¯·è¡¥å……å®Œæ•´çš„API endpointåœ°å€ï¼ˆå¦‚ï¼šhttps://openapi.alipay.com/gateway.doï¼‰",
    "è¯·è¯´æ˜è®¤è¯æ–¹å¼ï¼ˆå¦‚ï¼šä½¿ç”¨appId + privateKeyç­¾åï¼‰"
  ]
}
```

---

### 3.2 è¾“å‡ºçº¦æŸæœºåˆ¶ âœ…

**è®¾è®¡**ï¼šAgentçš„è¾“å‡ºå¿…é¡»æ ‡æ³¨ä¿¡æ¯æ¥æºå’Œå¯ä¿¡åº¦

**è¾“å‡ºæ ‡æ³¨è§„èŒƒ**ï¼š

```markdown
# ä»£ç å®¡æŸ¥æŠ¥å‘Š

## ğŸ” ä¿¡æ¯æ¥æºå£°æ˜

**ä»¥ä¸‹å†…å®¹åŸºäº**ï¼š
- âœ… é€šç”¨ç¼–ç¨‹æœ€ä½³å®è·µï¼ˆINTERNAL - é«˜å¯ä¿¡åº¦ï¼‰
- âœ… Pythonå®˜æ–¹æ–‡æ¡£ï¼ˆINTERNAL - é«˜å¯ä¿¡åº¦ï¼‰
- âš ï¸ é¡¹ç›®ä»£ç è§„èŒƒæ–‡æ¡£ï¼ˆEXTERNAL - ä¸­ç­‰å¯ä¿¡åº¦ï¼Œç‰ˆæœ¬ï¼šv2.1ï¼‰
- âš ï¸ å‡è®¾ï¼šå›¢é˜Ÿä½¿ç”¨PyTestæµ‹è¯•æ¡†æ¶ï¼ˆæœªåœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ï¼‰

## å®¡æŸ¥å†…å®¹

### 1. ä»£ç ç»“æ„ï¼ˆINTERNAL - é«˜å¯ä¿¡åº¦ï¼‰
åŸºäºé€šç”¨æœ€ä½³å®è·µï¼Œå»ºè®®...

### 2. æµ‹è¯•è¦†ç›–ç‡ï¼ˆEXTERNAL - ä¸­ç­‰å¯ä¿¡åº¦ï¼‰
æ ¹æ®ã€Šé¡¹ç›®ä»£ç è§„èŒƒv2.1ã€‹ï¼Œè¦æ±‚æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°80%...
**æ³¨æ„**ï¼šå¦‚æœè§„èŒƒå·²æ›´æ–°ï¼Œæ­¤è¦æ±‚å¯èƒ½å˜åŒ–ã€‚

### 3. ä¾èµ–ç®¡ç†ï¼ˆASSUMED - ä½å¯ä¿¡åº¦ï¼‰
å‡è®¾å›¢é˜Ÿä½¿ç”¨PyTestï¼Œå¦‚æœå®é™…ä½¿ç”¨å…¶ä»–æ¡†æ¶ï¼Œè¯·è°ƒæ•´...
**éœ€è¦ç¡®è®¤**ï¼šè¯·ç¡®è®¤å®é™…ä½¿ç”¨çš„æµ‹è¯•æ¡†æ¶ã€‚
```

**å¯ä¿¡åº¦åˆ†çº§**ï¼š

| æ ‡è®° | å«ä¹‰ | ç¤ºä¾‹ | å¯ä¿¡åº¦ |
|------|------|------|--------|
| âœ… INTERNAL | æ¥è‡ªLLMå†…éƒ¨çŸ¥è¯† | Pythonè¯­æ³•ã€è®¾è®¡æ¨¡å¼ | é«˜ |
| âœ… EXTERNAL-VALIDATED | å¤–éƒ¨è¾“å…¥ä¸”å·²éªŒè¯ | ç”¨æˆ·æä¾›çš„é…ç½®æ–‡ä»¶ | é«˜ |
| âš ï¸ EXTERNAL | å¤–éƒ¨è¾“å…¥ä½†éƒ¨åˆ†ä¸ç¡®å®š | è¿‡æ—¶çš„æ–‡æ¡£ | ä¸­ |
| â“ ASSUMED | åŸºäºå‡è®¾ | å‡è®¾ä½¿ç”¨æŸä¸ªæ¡†æ¶ | ä½ |
| ğŸš« HALLUCINATION-RISK | è™šæ„é£é™© | æœªæ‰¾åˆ°æ¥æºçš„æ•°æ® | æä½ |

---

### 3.3 ä¸ç¡®å®šæ€§å®¹å¿æœºåˆ¶ âœ…

**è®¾è®¡**ï¼šå…è®¸Agentåœ¨ä¸ç¡®å®šæ—¶æ ‡æ³¨ä¸ç¡®å®šæ€§

**ä¸ç¡®å®šæ€§æ ‡æ³¨**ï¼š

```python
# Agentç”Ÿæˆä»£ç æ—¶

class CodeGenerator:
    def generate_with_certainty(self, task, available_inputs):
        """
        ç”Ÿæˆä»£ç ï¼Œå¹¶æ ‡æ³¨ä¸ç¡®å®šéƒ¨åˆ†
        """
        code = []
        uncertain_parts = []

        # ç¡®å®šçš„éƒ¨åˆ†
        code.append("""
# æ•°æ®åº“è¿æ¥ï¼ˆINTERNAL - åŸºäºæœ€ä½³å®è·µï¼‰
import psycopg2
from psycopg2 import pool

connection_pool = psycopg2.pool.SimpleConnectionPool(
    minconn=1,
    maxconn=10,  # âš ï¸ ASSUMED - å‡è®¾å¹¶å‘è¿æ¥æ•°ä¸è¶…è¿‡10
    ...
)
        """)

        # ä¸ç¡®å®šçš„éƒ¨åˆ†
        uncertain_parts.append({
            "line": 10,
            "issue": "maxconnå€¼å‡è®¾ä¸º10ï¼Œå®é™…åº”æ ¹æ®å¹¶å‘é‡ç¡®å®š",
            "requires": "ç³»ç»Ÿçš„é¢„æœŸå¹¶å‘ç”¨æˆ·æ•°",
            "suggestion": "å¦‚æœå¹¶å‘ç”¨æˆ·æ•°>100ï¼Œå»ºè®®è°ƒæ•´ä¸º50"
        })

        return {
            "code": code,
            "uncertainty_report": uncertain_parts,
            "overall_certainty": "MEDIUM"  # HIGH, MEDIUM, LOW
        }
```

**ä¸ç¡®å®šæ€§æŠ¥å‘Š**ï¼š

```markdown
# ä¸ç¡®å®šæ€§æŠ¥å‘Š

## ä»£ç ç”Ÿæˆæ€»ä½“å¯ä¿¡åº¦ï¼šMEDIUM

## éœ€è¦ç¡®è®¤çš„éƒ¨åˆ†

| ä½ç½® | ä¸ç¡®å®šå†…å®¹ | éœ€è¦ä¿¡æ¯ | å»ºè®® |
|------|----------|---------|------|
| Line 10 | æ•°æ®åº“è¿æ¥æ± å¤§å° | ç³»ç»Ÿé¢„æœŸå¹¶å‘ç”¨æˆ·æ•° | å¦‚æœ>100ç”¨æˆ·ï¼Œè°ƒæ•´ä¸º50 |
| Line 45 | Sessionè¿‡æœŸæ—¶é—´ | ä¸šåŠ¡å®‰å…¨ç­–ç•¥ | é‡‘èç±»å»ºè®®30åˆ†é’Ÿï¼Œæ™®é€šç±»24å°æ—¶ |
| Line 120 | ç¼“å­˜ç­–ç•¥ | æ•°æ®è®¿é—®æ¨¡å¼ | è¯»å¤šå†™å°‘ç”¨Redisï¼Œè¯»å†™å‡è¡¡ç”¨Memcached |

## é«˜å¯ä¿¡åº¦éƒ¨åˆ†
- âœ… æ•°æ®åº“è¿æ¥é€»è¾‘ï¼ˆåŸºäºæœ€ä½³å®è·µï¼‰
- âœ… å¯†ç åŠ å¯†æ–¹æ³•ï¼ˆbcryptï¼Œè¡Œä¸šæ ‡å‡†ï¼‰
- âœ… SQLæ³¨å…¥é˜²æŠ¤ï¼ˆä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼‰

## ä¸‹ä¸€æ­¥å»ºè®®
1. æä¾›"é¢„æœŸå¹¶å‘ç”¨æˆ·æ•°" â†’ ä¼˜åŒ–è¿æ¥æ± é…ç½®
2. æä¾›"Sessionå®‰å…¨ç­–ç•¥" â†’ ç¡®å®šè¿‡æœŸæ—¶é—´
3. æä¾›"æ•°æ®è¯»å†™æ¯”ä¾‹" â†’ é€‰æ‹©ç¼“å­˜æ–¹æ¡ˆ
```

---

## å››ã€å®Œæ•´ç¤ºä¾‹ï¼šç”µå•†ç½‘ç«™å¼€å‘

### åœºæ™¯æè¿°

**ç”¨æˆ·ä»»åŠ¡**ï¼š"å¼€å‘ä¸€ä¸ªç”µå•†ç½‘ç«™ï¼Œæ”¯æŒå•†å“æµè§ˆã€è´­ç‰©è½¦ã€ä¸‹å•ã€æ”¯ä»˜"

### 4.1 Agentåˆ†è§£ä¸è¾“å…¥å£°æ˜

```
æ€»ç»ç†Agentæ”¶åˆ°ä»»åŠ¡
  â†“
å¬é›†ä¼šè®®ï¼ˆæŠ€æœ¯ç»ç† + äº§å“ç»ç†ï¼‰
  â†“
ä¼šè®®è¾¾æˆå…±è¯†ï¼šéœ€è¦ä»¥ä¸‹ä¸“å®¶
  - åç«¯ä¸“å®¶
  - å‰ç«¯ä¸“å®¶
  - æ•°æ®åº“ä¸“å®¶
  - æ”¯ä»˜é›†æˆä¸“å®¶
  â†“
ä»»åŠ¡åˆ†é…ç»™æŠ€æœ¯ç»ç†
  â†“
æŠ€æœ¯ç»ç†åˆ†é…ç»™å„ä¸“å®¶
```

**æ•°æ®åº“ä¸“å®¶çš„è¾“å…¥å£°æ˜**ï¼š

```json
{
  "agent_id": "agent_305_database_expert",
  "task_id": "task_001_db_design",
  "input_requirements": [
    {
      "input_id": "business_scale",
      "description": "é¢„æœŸçš„ä¸šåŠ¡è§„æ¨¡ï¼ˆç”¨æˆ·æ•°ã€å•†å“æ•°ã€è®¢å•é‡ï¼‰",
      "source": "EXTERNAL",
      "urgency": "BLOCKING",
      "reason": "ç”¨äºå†³å®šåˆ†åº“åˆ†è¡¨ç­–ç•¥ã€ç´¢å¼•æ–¹æ¡ˆ",
      "expected_format": "Text or JSON",
      "validation_criteria": [
        "åŒ…å«æ—¥æ´»ç”¨æˆ·æ•°é¢„ä¼°",
        "åŒ…å«å•†å“æ•°é‡é¢„ä¼°",
        "åŒ…å«æ—¥å‡è®¢å•é‡é¢„ä¼°"
      ]
    },
    {
      "input_id": "product_attributes",
      "description": "å•†å“çš„å±æ€§å­—æ®µï¼ˆå¦‚ï¼šé¢œè‰²ã€å°ºå¯¸ã€æè´¨ç­‰ï¼‰",
      "source": "EXTERNAL",
      "urgency": "BLOCKING",
      "reason": "éœ€è¦è®¾è®¡å•†å“è¡¨çš„å…·ä½“å­—æ®µ",
      "expected_format": "Markdown or JSON",
      "validation_criteria": [
        "åˆ—å‡ºæ‰€æœ‰å•†å“å±æ€§",
        "è¯´æ˜å±æ€§çš„æ•°æ®ç±»å‹ï¼ˆæ–‡æœ¬ã€æ•°å­—ã€æšä¸¾ç­‰ï¼‰"
      ]
    },
    {
      "input_id": "payment_methods",
      "description": "æ”¯æŒçš„æ”¯ä»˜æ–¹å¼ï¼ˆæ”¯ä»˜å®ã€å¾®ä¿¡ã€ä¿¡ç”¨å¡ç­‰ï¼‰",
      "source": "EXTERNAL",
      "urgency": "BLOCKING",
      "reason": "éœ€è¦è®¾è®¡è®¢å•æ”¯ä»˜ç›¸å…³å­—æ®µ",
      "expected_format": "List or JSON",
      "validation_criteria": [
        "æ˜ç¡®åˆ—å‡ºæ”¯æŒçš„æ”¯ä»˜æ–¹å¼"
      ]
    }
  ],
  "can_proceed_with_partial": false
}
```

**æ”¯ä»˜é›†æˆä¸“å®¶çš„è¾“å…¥å£°æ˜**ï¼š

```json
{
  "agent_id": "agent_308_payment_expert",
  "task_id": "task_002_payment_integration",
  "input_requirements": [
    {
      "input_id": "alipay_credentials",
      "description": "æ”¯ä»˜å®åº”ç”¨å‡­æ®ï¼ˆappIdã€privateKeyç­‰ï¼‰",
      "source": "EXTERNAL",
      "urgency": "BLOCKING",
      "reason": "å¿…éœ€çš„APIè°ƒç”¨å‡­è¯ï¼Œæ— æ³•ç”Ÿæˆ",
      "expected_format": "JSON file with sensitive data",
      "validation_criteria": [
        "åŒ…å«appId",
        "åŒ…å«privateKeyæˆ–å…¬é’¥",
        "åŒ…å«alipayPublicKey"
      ],
      "sensitive": true  // æ ‡è®°ä¸ºæ•æ„Ÿä¿¡æ¯
    },
    {
      "input_id": "alipay_api_doc",
      "description": "æ”¯ä»˜å®æ”¯ä»˜æ¥å£æ–‡æ¡£",
      "source": "EXTERNAL",
      "urgency": "BLOCKING",
      "reason": "APIæ–‡æ¡£å¿…é¡»ä»å®˜æ–¹è·å–ï¼Œä¸èƒ½è™šæ„",
      "expected_format": "PDF or Markdown",
      "validation_criteria": [
        "åŒ…å«æ”¯ä»˜æ¥å£URL",
        "åŒ…å«APIå‚æ•°è¯´æ˜",
        "åŒ…å«ç­¾åæ–¹æ³•",
        "åŒ…å«ç¤ºä¾‹ä»£ç "
      ]
    },
    {
      "input_id": "company_info",
      "description": "å…¬å¸ä¿¡æ¯ï¼ˆç”¨äºæ”¯ä»˜å›è°ƒéªŒè¯ï¼‰",
      "source": "EXTERNAL",
      "urgency": "BLOCKING",
      "reason": "éœ€è¦éªŒè¯æ”¯ä»˜é€šçŸ¥çš„æ¥æº",
      "expected_format": "Text or JSON",
      "validation_criteria": [
        "åŒ…å«å…¬å¸åç§°",
        "åŒ…å«è¥ä¸šæ‰§ç…§å·",
        "åŒ…å«å•†æˆ·ID"
      ]
    }
  ],
  "can_proceed_with_partial": false
}
```

**å‰ç«¯ä¸“å®¶çš„è¾“å…¥å£°æ˜**ï¼š

```json
{
  "agent_id": "agent_306_frontend_expert",
  "task_id": "task_003_frontend_design",
  "input_requirements": [
    {
      "input_id": "brand_guidelines",
      "description": "å“ç‰Œè®¾è®¡è§„èŒƒï¼ˆé¢œè‰²ã€å­—ä½“ã€Logoç­‰ï¼‰",
      "source": "EXTERNAL",
      "urgency": "OPTIONAL",
      "reason": "ç”¨äºè®¾è®¡ç¬¦åˆå“ç‰Œé£æ ¼çš„ç•Œé¢",
      "expected_format": "PDF, CSS or Image",
      "validation_criteria": [
        "åŒ…å«ä¸»è‰²è°ƒ",
        "åŒ…å«è¾…åŠ©è‰²",
        "åŒ…å«å­—ä½“è§„èŒƒï¼ˆå¦‚æœ‰ï¼‰",
        "åŒ…å«Logoæ–‡ä»¶"
      ]
    },
    {
      "input_id": "ui_reference",
      "description": "å‚è€ƒçš„UIè®¾è®¡ï¼ˆç«å“ç½‘ç«™æˆ–è®¾è®¡ç¨¿ï¼‰",
      "source": "EXTERNAL",
      "urgency": "OPTIONAL",
      "reason": "å¸®åŠ©ç†è§£ç”¨æˆ·çš„UIåå¥½",
      "expected_format": "Screenshot, Link or Design file",
      "validation_criteria": []
    }
  ],
  "can_proceed_with_partial": true  // å¯ä»¥å…ˆåšé€šç”¨è®¾è®¡
}
```

### 4.2 ç”¨æˆ·è¡¥å……è¾“å…¥

**ç”¨æˆ·ç¬¬ä¸€æ¬¡æä¾›**ï¼š

```
âœ… æä¾› business_scale:
{
  "daily_active_users": "é¢„è®¡1000-5000",
  "total_products": "é¢„è®¡10000å·¦å³",
  "daily_orders": "é¢„è®¡500-2000"
}

âœ… æä¾› product_attributes:
[
  {"name": "é¢œè‰²", "type": "enum", "values": ["çº¢", "è“", "ç»¿", "é»‘", "ç™½"]},
  {"name": "å°ºå¯¸", "type": "text", "example": "S, M, L, XL"},
  {"name": "æè´¨", "type": "text", "example": "æ£‰ã€éº»ã€ä¸ç»¸"}
]

âš ï¸ æš‚ä¸æä¾›ï¼špayment_methods, alipay_credentials, alipay_api_doc, brand_guidelines
```

**ç³»ç»Ÿå“åº”**ï¼š

```
æ•°æ®åº“ä¸“å®¶ï¼š
  â†’ è¾“å…¥éªŒè¯é€šè¿‡
  â†’ å¼€å§‹è®¾è®¡æ•°æ®åº“ï¼ˆä½¿ç”¨é€šç”¨æ”¯ä»˜å­—æ®µï¼Œå¾…åç»­è¡¥å……ï¼‰
  â†’ ç”Ÿæˆ workspace/artifacts/task_001/db_schema.sql

æ”¯ä»˜é›†æˆä¸“å®¶ï¼š
  â†’ ä»ç„¶ç¼ºå°‘å…³é”®è¾“å…¥
  â†’ ä¿æŒ BLOCKED_WAITING_INPUT çŠ¶æ€
  â†’ åœ¨ workspace/required_docs/task_002.md ä¸­ç”Ÿæˆéœ€æ±‚æ¸…å•

å‰ç«¯ä¸“å®¶ï¼š
  â†’ brand_guidelines æ˜¯ OPTIONAL
  â†’ è®¾ç½® can_proceed_with_partial = true
  â†’ ä½¿ç”¨é€šç”¨è®¾è®¡åŸåˆ™ç”Ÿæˆå‰ç«¯ç•Œé¢
  â†’ åœ¨æ–‡æ¡£ä¸­æ ‡æ³¨ï¼šé¢œè‰²ã€å­—ä½“å¾…æ ¹æ®å“ç‰Œè§„èŒƒè°ƒæ•´
  â†’ ç”Ÿæˆ workspace/artifacts/task_003/frontend_prototype/
```

**ç”¨æˆ·ç¬¬äºŒæ¬¡æä¾›**ï¼ˆå‡ å¤©åï¼‰ï¼š

```
âœ… æä¾› payment_methods:
["æ”¯ä»˜å®", "å¾®ä¿¡æ”¯ä»˜", "ä¿¡ç”¨å¡"]

âœ… æä¾› alipay_api_doc:
ï¼ˆä»æ”¯ä»˜å®å¼€å‘è€…ä¸­å¿ƒä¸‹è½½çš„çœŸå®PDFï¼‰

âœ… æä¾› alipay_credentials:
{
  "appId": "2021001234567890",
  "privateKey": "...",
  "alipayPublicKey": "..."
}

âœ… æä¾› brand_guidelines:
{
  "primary_color": "#FF6B6B",
  "secondary_color": "#4ECDC4",
  "font_family": "Helvetica, Arial, sans-serif",
  "logo": "files/logo.png"
}
```

**ç³»ç»Ÿå“åº”**ï¼š

```
æ”¯ä»˜é›†æˆä¸“å®¶ï¼š
  â†’ æ‰§è¡Œè¾“å…¥éªŒè¯
  â†’ éªŒè¯é€šè¿‡
  â†’ ä½¿ç”¨çœŸå®çš„APIæ–‡æ¡£å¼€å‘æ”¯ä»˜åŠŸèƒ½
  â†’ ä¸ä¼šç¼–é€ ä»»ä½•APIå‚æ•°æˆ–æµç¨‹

æ•°æ®åº“ä¸“å®¶ï¼š
  â†’ æ”¶åˆ° payment_methods
  â†’ æ›´æ–°æ•°æ®åº“è®¾è®¡ï¼Œæ·»åŠ æ”¯ä»˜å®ã€å¾®ä¿¡ã€ä¿¡ç”¨å¡ç›¸å…³å­—æ®µ
  â†’ æ ‡è®°ä¹‹å‰çš„ç‰ˆæœ¬ä¸º DRAFTï¼Œæ–°ç‰ˆæœ¬ä¸º FINAL

å‰ç«¯ä¸“å®¶ï¼š
  â†’ æ”¶åˆ° brand_guidelines
  â†’ æ›´æ–°å‰ç«¯ç•Œé¢ï¼Œä½¿ç”¨æ­£ç¡®çš„é¢œè‰²å’Œå­—ä½“
  â†’ æ›¿æ¢Logo
  â†’ æ ‡è®°æ›´æ–°å†…å®¹
```

### 4.3 å®Œæ•´çš„äº§å‡ºç¤ºä¾‹

**æ•°æ®åº“è®¾è®¡æ–‡æ¡£**ï¼ˆæ ‡æ³¨ä¿¡æ¯æ¥æºï¼‰ï¼š

```markdown
# ç”µå•†ç³»ç»Ÿæ•°æ®åº“è®¾è®¡

## ğŸ” ä¿¡æ¯æ¥æºå£°æ˜

**åŸºäº**ï¼š
- âœ… é€šç”¨æ•°æ®åº“è®¾è®¡æœ€ä½³å®è·µï¼ˆINTERNALï¼‰
- âœ… æä¾›çš„ä¸šåŠ¡è§„æ¨¡ï¼š1000-5000 DAUï¼ˆEXTERNAL-VALIDATEDï¼‰
- âœ… æä¾›çš„å•†å“å±æ€§ï¼ˆEXTERNAL-VALIDATEDï¼‰
- âœ… æä¾›çš„æ”¯ä»˜æ–¹å¼ï¼šæ”¯ä»˜å®ã€å¾®ä¿¡ã€ä¿¡ç”¨å¡ï¼ˆEXTERNAL-VALIDATEDï¼‰

## è¡¨ç»“æ„è®¾è®¡

### 1. ç”¨æˆ·è¡¨ï¼ˆusersï¼‰

**è®¾è®¡ä¾æ®**ï¼šINTERNAL - åŸºäºç”¨æˆ·è®¤è¯æœ€ä½³å®è·µ

```sql
CREATE TABLE users (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_email (email),
  INDEX idx_username (username)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 2. å•†å“è¡¨ï¼ˆproductsï¼‰

**è®¾è®¡ä¾æ®**ï¼š
- è¡¨ç»“æ„ï¼šINTERNAL - åŸºäºç”µå•†æœ€ä½³å®è·µ
- å­—æ®µé•¿åº¦ï¼šEXTERNAL-VALIDATED - åŸºäº10000ä¸ªå•†å“è§„æ¨¡
- å±æ€§å­—æ®µï¼šEXTERNAL-VALIDATED - åŸºäºç”¨æˆ·æä¾›çš„å±æ€§åˆ—è¡¨

```sql
CREATE TABLE products (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(200) NOT NULL,
  description TEXT,
  price DECIMAL(10, 2) NOT NULL,
  stock INT DEFAULT 0,

  -- å•†å“å±æ€§ï¼ˆEXTERNAL-VALIDATED - åŸºäºç”¨æˆ·æä¾›çš„å±æ€§ï¼‰
  color VARCHAR(50) COMMENT 'é¢œè‰²ï¼šçº¢ã€è“ã€ç»¿ã€é»‘ã€ç™½',
  size VARCHAR(50) COMMENT 'å°ºå¯¸ï¼šS, M, L, XLæˆ–è‡ªå®šä¹‰',
  material VARCHAR(100) COMMENT 'æè´¨ï¼šæ£‰ã€éº»ã€ä¸ç»¸ç­‰',

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_price (price),
  INDEX idx_stock (stock)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**âš ï¸ æ³¨æ„**ï¼š
- å­—æ®µé•¿åº¦åŸºäº10000å•†å“é¢„ä¼°ï¼Œå¦‚æœå•†å“æ•°è¶…è¿‡100000ï¼Œå»ºè®®ä¼˜åŒ–ç´¢å¼•
- å±æ€§å­—æ®µä½¿ç”¨VARCHARç±»å‹ï¼Œå¦‚æœéœ€è¦ä¸¥æ ¼ç±»å‹çº¦æŸï¼Œå¯æ”¹ä¸ºENUM

### 3. è®¢å•è¡¨ï¼ˆordersï¼‰

**è®¾è®¡ä¾æ®**ï¼š
- è¡¨ç»“æ„ï¼šINTERNAL - åŸºäºè®¢å•ç®¡ç†æœ€ä½³å®è·µ
- æ”¯ä»˜å­—æ®µï¼šEXTERNAL-VALIDATED - åŸºäºæ”¯ä»˜å®ã€å¾®ä¿¡ã€ä¿¡ç”¨å¡

```sql
CREATE TABLE orders (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  total_amount DECIMAL(10, 2) NOT NULL,

  -- æ”¯ä»˜ä¿¡æ¯ï¼ˆEXTERNAL-VALIDATED - åŸºäºç”¨æˆ·æä¾›çš„æ”¯ä»˜æ–¹å¼ï¼‰
  payment_method ENUM('ALIPAY', 'WECHAT', 'CREDIT_CARD') NOT NULL,
  payment_status ENUM('PENDING', 'PAID', 'FAILED', 'REFUNDED') DEFAULT 'PENDING',

  -- æ”¯ä»˜å®ç›¸å…³å­—æ®µï¼ˆEXTERNAL-VALIDATED - åŸºäºæ”¯ä»˜å®APIæ–‡æ¡£ï¼‰
  alipay_trade_no VARCHAR(100) COMMENT 'æ”¯ä»˜å®äº¤æ˜“å·',
  alipay_buyer_id VARCHAR(100) COMMENT 'æ”¯ä»˜å®ä¹°å®¶ID',

  -- å¾®ä¿¡æ”¯ä»˜ç›¸å…³å­—æ®µï¼ˆEXTERNAL-VALIDATED - é¢„ç•™ï¼‰
  wechat_transaction_id VARCHAR(100) COMMENT 'å¾®ä¿¡äº¤æ˜“å·',

  -- ä¿¡ç”¨å¡æ”¯ä»˜ç›¸å…³å­—æ®µï¼ˆEXTERNAL-VALIDATED - é¢„ç•™ï¼‰
  card_last_four VARCHAR(4) COMMENT 'å¡å·åå››ä½',

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  paid_at TIMESTAMP NULL,
  FOREIGN KEY (user_id) REFERENCES users(id),
  INDEX idx_user (user_id),
  INDEX idx_payment_status (payment_status),
  INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**âš ï¸ æ³¨æ„**ï¼š
- æ”¯ä»˜ç›¸å…³å­—æ®µåä¸¥æ ¼éµå¾ªæ”¯ä»˜å®APIæ–‡æ¡£ï¼ˆEXTERNAL-VALIDATEDï¼‰
- å¾®ä¿¡å’Œä¿¡ç”¨å¡å­—æ®µé¢„ç•™ï¼Œå¾…é›†æˆæ—¶è¡¥å……

## è®¾è®¡å†³ç­–è¯´æ˜

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨ InnoDB å¼•æ“ï¼Ÿï¼ˆINTERNALï¼‰
åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š
- æ”¯æŒäº‹åŠ¡ï¼ˆè®¢å•æ”¯ä»˜éœ€è¦äº‹åŠ¡ä¿è¯ï¼‰
- æ”¯æŒå¤–é”®çº¦æŸ
- è¡Œçº§é”ï¼Œé€‚åˆé«˜å¹¶å‘

### 2. ä¸ºä»€ä¹ˆç´¢å¼•è¿™äº›å­—æ®µï¼Ÿï¼ˆEXTERNAL-VALIDATEDï¼‰
åŸºäº1000-5000 DAUçš„è§„æ¨¡é¢„ä¼°ï¼š
- `idx_email`: ç”¨æˆ·ç™»å½•éœ€è¦
- `idx_price`: å•†å“æŒ‰ä»·æ ¼ç­›é€‰éœ€è¦
- `idx_payment_status`: è®¢å•æŸ¥è¯¢éœ€è¦

### 3. æœªç¡®å®šçš„è®¾è®¡ï¼ˆEXTERNAL - éœ€è¦è¡¥å……ï¼‰
- [ ] åˆ†åº“åˆ†è¡¨ç­–ç•¥ï¼šå–å†³äºå®é™…æ•°æ®é‡å¢é•¿
- [ ] å½’æ¡£ç­–ç•¥ï¼šå–å†³äºä¸šåŠ¡è¦æ±‚ï¼ˆå¦‚æ˜¯å¦éœ€è¦ä¿ç•™å†å²è®¢å•ï¼‰
- [ ] å¤‡ä»½ç­–ç•¥ï¼šå–å†³äºä¸šåŠ¡SLAï¼ˆRTOã€RPOè¦æ±‚ï¼‰

## ä¸‹ä¸€æ­¥éœ€è¦çš„ä¿¡æ¯
1. å®é™…çš„æ”¯ä»˜å®å›è°ƒæ¥å£æ–‡æ¡£ï¼ˆç”¨äºè®¾è®¡é€šçŸ¥å¤„ç†è¡¨ï¼‰
2. ä¸šåŠ¡çš„è®¢å•çŠ¶æ€æµè½¬è§„åˆ™ï¼ˆç”¨äºè®¾è®¡è®¢å•çŠ¶æ€å­—æ®µï¼‰
```

---

## äº”ã€æŠ€æœ¯å®ç°è¦ç‚¹

### 5.1 æç¤ºè¯æ¨¡æ¿ç»“æ„

```python
AGENT_PROMPT_TEMPLATE = """
# è§’è‰²ï¼š{role}

## æ ¸å¿ƒèƒ½åŠ›
{capabilities}

## âš ï¸ åå¹»è§‰çº¦æŸï¼ˆCRITICALï¼‰

ä½ **ä¸¥æ ¼ç¦æ­¢**ç¼–é€ ã€è™šæ„ã€çŒœæµ‹ä»¥ä¸‹å†…å®¹ï¼š
1. é¡¹ç›®ç‰¹å®šä¿¡æ¯ï¼ˆå…¬å¸æ”¿ç­–ã€ä¸šåŠ¡è§„åˆ™ã€ç”¨æˆ·æ•°æ®ï¼‰
2. ç¬¬ä¸‰æ–¹é›†æˆä¿¡æ¯ï¼ˆAPIæ–‡æ¡£ã€SDKä½¿ç”¨ã€å¯†é’¥ï¼‰
3. å®æ—¶/åŠ¨æ€æ•°æ®ï¼ˆå½“å‰æ—¶é—´ã€ä»·æ ¼ã€åº“å­˜ï¼‰
4. è®¾è®¡åå¥½ï¼ˆLogoã€é¢œè‰²ã€ä¸»é¢˜ï¼‰

ä½ å¯ä»¥ç”Ÿæˆçš„å†…å®¹ï¼š
1. é€šç”¨æŠ€æœ¯çŸ¥è¯†ï¼ˆç¼–ç¨‹è¯­æ³•ã€ç®—æ³•ã€è®¾è®¡æ¨¡å¼ï¼‰
2. è¡Œä¸šæœ€ä½³å®è·µï¼ˆæ¶æ„åŸåˆ™ã€å®‰å…¨æ ‡å‡†ï¼‰
3. æ¨¡æ¿å’Œç»“æ„ï¼ˆä»£ç æ¨¡æ¿ã€æ–‡æ¡£ç»“æ„ï¼‰

## ğŸ›¡ï¸ è¾“å…¥éœ€æ±‚å£°æ˜æœºåˆ¶

å½“ä»»åŠ¡éœ€è¦å¤–éƒ¨ä¿¡æ¯æ—¶ï¼Œä½ **å¿…é¡»**ï¼š
1. è¯†åˆ«éœ€æ±‚ï¼šæ‰«æä»»åŠ¡æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯
2. åˆ†ç±»åˆ¤æ–­ï¼šåˆ¤æ–­æ¯é¡¹ä¿¡æ¯æ˜¯INTERNALè¿˜æ˜¯EXTERNAL
3. æ˜¾å¼å£°æ˜ï¼šä¸ºæ‰€æœ‰EXTERNALä¿¡æ¯å£°æ˜è¾“å…¥éœ€æ±‚
4. ç­‰å¾…è¾“å…¥ï¼šåœ¨æœªæ”¶åˆ°çœŸå®è¾“å…¥å‰ï¼Œç¦æ­¢ç”Ÿæˆè™šå‡å†…å®¹

### ä¿¡æ¯åˆ†ç±»å†³ç­–æ ‘

```
{decision_tree}
```

### è¾“å…¥éœ€æ±‚æ ¼å¼

```json
{input_requirement_schema}
```

## å·¥ä½œæµç¨‹

1. **æ”¶åˆ°ä»»åŠ¡** â†’ 2. **åˆ†è§£ä»»åŠ¡** â†’ 3. **è¯†åˆ«ä¿¡æ¯éœ€æ±‚**
â†’ 4. **åˆ†ç±»åˆ¤æ–­ï¼ˆINTERNAL/EXTERNALï¼‰**
â†’ 5a. **å¦‚æœå…¨æ˜¯INTERNAL** â†’ ç›´æ¥æ‰§è¡Œ
â†’ 5b. **å¦‚æœæœ‰EXTERNAL** â†’ å£°æ˜è¾“å…¥éœ€æ±‚ â†’ ç­‰å¾…è¾“å…¥
â†’ 6. **æ”¶åˆ°è¾“å…¥** â†’ éªŒè¯è¾“å…¥ â†’ æ‰§è¡Œä»»åŠ¡
â†’ 7. **ç”Ÿæˆäº§å‡º** â†’ æ ‡æ³¨ä¿¡æ¯æ¥æºå’Œå¯ä¿¡åº¦

## è¾“å‡ºè§„èŒƒ

æ‰€æœ‰äº§å‡ºå¿…é¡»æ ‡æ³¨ä¿¡æ¯æ¥æºï¼š
- âœ… INTERNAL - åŸºäºLLMå†…éƒ¨çŸ¥è¯†
- âœ… EXTERNAL-VALIDATED - å¤–éƒ¨è¾“å…¥ä¸”å·²éªŒè¯
- âš ï¸ EXTERNAL - å¤–éƒ¨è¾“å…¥ä½†éƒ¨åˆ†ä¸ç¡®å®š
- â“ ASSUMED - åŸºäºå‡è®¾ï¼Œéœ€è¦ç¡®è®¤

## ä¸ç¡®å®šæ€§çš„å¤„ç†

å½“ä¿¡æ¯ä¸å®Œæ•´æ—¶ï¼š
1. **ä¿å®ˆåŸåˆ™**ï¼šå€¾å‘äºç­‰å¾…å¤–éƒ¨è¾“å…¥
2. **éƒ¨åˆ†æ‰§è¡Œ**ï¼šå¦‚æœå¯èƒ½ï¼Œå…ˆå®Œæˆç¡®å®šçš„éƒ¨åˆ†
3. **æ˜ç¡®æ ‡æ³¨**ï¼šåœ¨è¾“å‡ºä¸­æ ‡æ³¨ä¸ç¡®å®šçš„éƒ¨åˆ†
4. **è¯·æ±‚ç¡®è®¤**ï¼šåˆ—å‡ºéœ€è¦ç¡®è®¤çš„é—®é¢˜æ¸…å•

---
"""
```

### 5.2 å†³ç­–æ ‘æç¤ºè¯

```python
DECISION_TREE_PROMPT = """
## ä¿¡æ¯åˆ†ç±»å†³ç­–æ ‘

å¯¹äºä»»åŠ¡æ‰€éœ€çš„æ¯ä¸ªä¿¡æ¯é¡¹ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºåˆ¤æ–­ï¼š

### ç¬¬ä¸€å±‚ï¼šæ˜¯å¦å±äºé€šç”¨çŸ¥è¯†ï¼Ÿ

**åˆ¤æ–­æ ‡å‡†**ï¼š
- æ˜¯å¦æ˜¯å…¬å¼€çš„ã€ä¸ä¾èµ–ç‰¹å®šä¸Šä¸‹æ–‡çš„çŸ¥è¯†ï¼Ÿ
- æ˜¯å¦åœ¨å¤šä¸ªé¡¹ç›®ä¸­éƒ½é€‚ç”¨ï¼Ÿ
- æ˜¯å¦å¯ä»¥é€šè¿‡æ•™ç§‘ä¹¦ã€å®˜æ–¹æ–‡æ¡£è·å¾—ï¼Ÿ

**ç¤ºä¾‹ï¼ˆYES â†’ INTERNALï¼‰**ï¼š
- âœ… Pythonè¯­æ³•ã€JavaScriptç‰¹æ€§
- âœ… HTTPåè®®ã€REST APIè®¾è®¡åŸåˆ™
- âœ… æ•°æ®åº“èŒƒå¼ã€ç´¢å¼•åŸç†
- âœ… ç®—æ³•ã€æ•°æ®ç»“æ„
- âœ… è®¾è®¡æ¨¡å¼ã€æ¶æ„åŸåˆ™

**ç¤ºä¾‹ï¼ˆNO â†’ ç»§ç»­åˆ¤æ–­ï¼‰**ï¼š
- âŒ å…¬å¸çš„ä»£ç è§„èŒƒï¼ˆé¡¹ç›®ç‰¹å®šï¼‰
- âŒ ç”¨æˆ·çš„ä¸šåŠ¡æ•°æ®ï¼ˆé¡¹ç›®ç‰¹å®šï¼‰
- âŒ ç¬¬ä¸‰æ–¹APIæ–‡æ¡£ï¼ˆå¤–éƒ¨æ¥æºï¼‰

---

### ç¬¬äºŒå±‚ï¼šæ˜¯å¦å±äºé¡¹ç›®/ä¸šåŠ¡ç‰¹å®šï¼Ÿ

**åˆ¤æ–­æ ‡å‡†**ï¼š
- æ˜¯å¦æ˜¯è¿™ä¸ªé¡¹ç›®ç‹¬æœ‰çš„ï¼Ÿ
- æ˜¯å¦åŒ…å«äº†ä¸šåŠ¡è§„åˆ™ã€æµç¨‹ï¼Ÿ
- æ˜¯å¦æ¶‰åŠç”¨æˆ·æ•°æ®ã€å†å²è®°å½•ï¼Ÿ

**ç¤ºä¾‹ï¼ˆYES â†’ EXTERNALï¼‰**ï¼š
- âœ… å…¬å¸æ”¿ç­–ã€ä¸šåŠ¡è§„åˆ™
- âœ… ç”¨æˆ·åˆ—è¡¨ã€äº§å“ç›®å½•
- âœ… ç³»ç»Ÿé…ç½®ã€ç¯å¢ƒå˜é‡
- âœ… å†å²å†³ç­–ã€ä¼šè®®çºªè¦

**ç»§ç»­åˆ¤æ–­ï¼ˆNOï¼‰**ï¼š

---

### ç¬¬ä¸‰å±‚ï¼šæ˜¯å¦å±äºç¬¬ä¸‰æ–¹é›†æˆï¼Ÿ

**åˆ¤æ–­æ ‡å‡†**ï¼š
- æ˜¯å¦éœ€è¦è°ƒç”¨å¤–éƒ¨APIï¼Ÿ
- æ˜¯å¦éœ€è¦ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Ÿ
- æ˜¯å¦éœ€è¦ç¬¬ä¸‰æ–¹å‡­è¯ï¼Ÿ

**ç¤ºä¾‹ï¼ˆYES â†’ EXTERNALï¼‰**ï¼š
- âœ… æ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜APIæ–‡æ¡£
- âœ… äº‘æœåŠ¡å•†ï¼ˆAWSã€é˜¿é‡Œäº‘ï¼‰çš„é…ç½®
- âœ… SaaSæœåŠ¡çš„é›†æˆæ–¹å¼
- âœ… API Keyã€å¯†é’¥

**ç»§ç»­åˆ¤æ–­ï¼ˆNOï¼‰**ï¼š

---

### ç¬¬å››å±‚ï¼šæ˜¯å¦å±äºå®æ—¶/åŠ¨æ€æ•°æ®ï¼Ÿ

**åˆ¤æ–­æ ‡å‡†**ï¼š
- æ˜¯å¦éšæ—¶é—´å˜åŒ–ï¼Ÿ
- æ˜¯å¦éœ€è¦ä»å¤–éƒ¨ç³»ç»Ÿè·å–ï¼Ÿ

**ç¤ºä¾‹ï¼ˆYES â†’ EXTERNALï¼‰**ï¼š
- âœ… å½“å‰æ—¶é—´ã€æ—¥æœŸ
- âœ… å®æ—¶ä»·æ ¼ã€åº“å­˜
- âœ… ç”¨æˆ·è¡Œä¸ºæ•°æ®
- âœ… ç³»ç»ŸçŠ¶æ€ã€ç›‘æ§æ•°æ®

**å¦‚æœä»¥ä¸Šéƒ½æ˜¯NO**ï¼š
- â†’ å¯èƒ½æ˜¯INTERNALï¼ˆä½¿ç”¨æœ€ä½³å®è·µï¼‰
- â†’ ä½†å¦‚æœä¸ç¡®å®šï¼Œå€¾å‘äºEXTERNALï¼ˆä¿å®ˆåŸåˆ™ï¼‰

---

## è¾¹ç•Œæ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šè®¾è®¡REST API
- APIè®¾è®¡åŸåˆ™ â†’ INTERNALï¼ˆæœ€ä½³å®è·µï¼‰
- å…·ä½“çš„endpointè·¯å¾„ â†’ EXTERNALï¼ˆä¸šåŠ¡è§„åˆ™ï¼‰
- è¯·æ±‚/å“åº”æ ¼å¼ â†’ EXTERNALï¼ˆä¸šåŠ¡éœ€æ±‚ï¼‰

### æ¡ˆä¾‹2ï¼šæ•°æ®åº“è®¾è®¡
- è¡¨ç»“æ„ã€å…³ç³» â†’ INTERNALï¼ˆé€šç”¨è®¾è®¡ï¼‰
- å­—æ®µé•¿åº¦ã€ç±»å‹ â†’ EXTERNALï¼ˆå–å†³äºä¸šåŠ¡ï¼‰
- ç´¢å¼•ç­–ç•¥ â†’ EXTERNALï¼ˆå–å†³äºæŸ¥è¯¢æ¨¡å¼ï¼‰

### æ¡ˆä¾‹3ï¼šä»£ç å®ç°
- ç¼–ç è§„èŒƒ â†’ EXTERNALï¼ˆå›¢é˜Ÿçº¦å®šï¼‰
- ç®—æ³•é€‰æ‹© â†’ INTERNALï¼ˆæ€§èƒ½åˆ†æï¼‰
- åº“çš„é€‰æ‹© â†’ å¯èƒ½EXTERNALï¼ˆå›¢é˜ŸæŠ€æœ¯æ ˆï¼‰
"""
```

### 5.3 éªŒè¯å™¨å®ç°

```python
class InputRequirementValidator:
    """è¾“å…¥éœ€æ±‚éªŒè¯å™¨"""

    def validate_requirement_declaration(self, requirements):
        """
        éªŒè¯Agentå£°æ˜çš„è¾“å…¥éœ€æ±‚æ˜¯å¦åˆç†

        ç›®æ ‡ï¼šé˜²æ­¢Agenté—æ¼å…³é”®çš„å¤–éƒ¨è¾“å…¥éœ€æ±‚
        """
        issues = []

        for req in requirements:
            # æ£€æŸ¥1ï¼šsourceå­—æ®µæ˜¯å¦å­˜åœ¨
            if "source" not in req:
                issues.append(f"{req['input_id']}: ç¼ºå°‘sourceå­—æ®µ")

            # æ£€æŸ¥2ï¼šå¦‚æœæ˜¯INTERNALï¼ŒéªŒè¯ç¡®å®åº”è¯¥æ˜¯INTERNAL
            if req.get("source") == "INTERNAL":
                if self.looks_like_external(req["description"]):
                    issues.append(
                        f"{req['input_id']}: æ ‡è®°ä¸ºINTERNALï¼Œä½†æè¿°æ˜¾ç¤ºåº”è¯¥æ˜¯EXTERNAL"
                    )

            # æ£€æŸ¥3ï¼šå¦‚æœæ˜¯EXTERNALï¼ŒéªŒè¯urgencyæ˜¯å¦åˆç†
            if req.get("source") == "EXTERNAL":
                if req.get("urgency") != "BLOCKING":
                    issues.append(
                        f"{req['input_id']}: EXTERNALè¾“å…¥åº”è¯¥æ˜¯BLOCKING urgency"
                    )

        return issues

    def looks_like_external(self, description):
        """
        åˆ¤æ–­æè¿°æ˜¯å¦åƒæ˜¯å¤–éƒ¨è¾“å…¥
        """
        external_keywords = [
            "å…¬å¸", "ä¸šåŠ¡", "ç”¨æˆ·", "å®¢æˆ·",
            "é…ç½®", "å¯†é’¥", "APIæ–‡æ¡£",
            "å“ç‰Œ", "è§„èŒƒ", "å†å²",
            "å®æ—¶", "å½“å‰", "æœ€æ–°",
        ]

        description_lower = description.lower()
        return any(keyword in description for keyword in external_keywords)
```

---

## å…­ã€æµ‹è¯•ç­–ç•¥

### 6.1 å•å…ƒæµ‹è¯•

```python
class TestHallucinationPrevention(unittest.TestCase):
    """æµ‹è¯•é˜²å¹»è§‰æœºåˆ¶"""

    def test_agent_declares_external_inputs(self):
        """æµ‹è¯•Agentæ˜¯å¦æ­£ç¡®å£°æ˜å¤–éƒ¨è¾“å…¥"""
        agent = DatabaseExpertAgent()

        task = "è®¾è®¡ç”¨æˆ·è¡¨"

        result = agent.analyze_task_and_declare_inputs(task)

        # åº”è¯¥å£°æ˜éœ€è¦å¤–éƒ¨è¾“å…¥ï¼ˆè¡¨ç»“æ„ç»†èŠ‚ï¼‰
        self.assertTrue(len(result["input_requirements"]) > 0)

        # æ£€æŸ¥æ˜¯å¦æœ‰EXTERNALç±»å‹çš„è¾“å…¥
        external_reqs = [
            r for r in result["input_requirements"]
            if r["source"] == "EXTERNAL"
        ]
        self.assertTrue(len(external_reqs) > 0)

    def test_agent_does_not_generate_fake_credentials(self):
        """æµ‹è¯•Agentä¸ä¼šç”Ÿæˆè™šå‡çš„å‡­è¯"""
        agent = PaymentIntegrationAgent()

        # æä¾›ä»»åŠ¡ï¼Œä½†ä¸æä¾›å‡­è¯
        task = "é›†æˆæ”¯ä»˜å®æ”¯ä»˜"
        inputs = {}  # æ•…æ„ä¸æä¾›alipay_credentials

        # Agentåº”è¯¥æ‹’ç»æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç”Ÿæˆå‡çš„å‡­è¯
        result = agent.execute(task, inputs)

        self.assertEqual(result["status"], "BLOCKED_WAITING_INPUT")
        self.assertIn("alipay_credentials", result["missing_inputs"])

        # ç¡®ä¿äº§å‡ºä¸­æ²¡æœ‰è™šå‡çš„API Key
        self.assertNotIn("sk_test_", str(result))
        self.assertNotIn("fake_api_key", str(result))

    def test_agent_marks_uncertainty(self):
        """æµ‹è¯•Agentæ˜¯å¦æ ‡æ³¨ä¸ç¡®å®šæ€§"""
        agent = FrontendExpertAgent()

        task = "è®¾è®¡ç™»å½•é¡µé¢"
        inputs = {}  # ä¸æä¾›å“ç‰Œè§„èŒƒ

        result = agent.execute(task, inputs)

        # åº”è¯¥ä½¿ç”¨é€šç”¨è®¾è®¡
        self.assertIn("output", result)

        # ä½†åº”è¯¥æ ‡æ³¨ä¸ç¡®å®šçš„éƒ¨åˆ†
        self.assertIn("uncertainty_report", result)
        self.assertTrue(
            any("é¢œè‰²" in u["issue"] for u in result["uncertainty_report"])
        )
```

### 6.2 é›†æˆæµ‹è¯•åœºæ™¯

```python
class TestHallucinationScenarios(unittest.TestCase):
    """æµ‹è¯•çœŸå®åœºæ™¯ä¸­çš„é˜²å¹»è§‰"""

    def test_ecommerce_payment_scenario(self):
        """
        åœºæ™¯ï¼šå¼€å‘ç”µå•†æ”¯ä»˜åŠŸèƒ½
        éªŒè¯ï¼šAgentä¸ä¼šç¼–é€ æ”¯ä»˜å®APIæ–‡æ¡£
        """
        # 1. åˆ›å»ºæ”¯ä»˜é›†æˆä¸“å®¶
        payment_agent = PaymentIntegrationAgent()

        # 2. åˆ†é…ä»»åŠ¡
        task = "é›†æˆæ”¯ä»˜å®æ”¯ä»˜"

        # 3. ä¸æä¾›APIæ–‡æ¡£
        inputs = {}

        # 4. æ‰§è¡Œ
        result = payment_agent.execute(task, inputs)

        # 5. éªŒè¯ï¼šåº”è¯¥ç­‰å¾…è¾“å…¥
        self.assertEqual(result["status"], "BLOCKED_WAITING_INPUT")
        self.assertIn("alipay_api_doc", result["missing_inputs"])

        # 6. æä¾›çœŸå®çš„APIæ–‡æ¡£
        real_api_doc = load_file("real_alipay_api_doc.pdf")
        inputs["alipay_api_doc"] = real_api_doc

        # 7. å†æ¬¡æ‰§è¡Œ
        result = payment_agent.execute(task, inputs)

        # 8. éªŒè¯ï¼šåº”è¯¥æˆåŠŸæ‰§è¡Œ
        self.assertEqual(result["status"], "COMPLETED")

        # 9. éªŒè¯ï¼šäº§å‡ºä¸­ä½¿ç”¨çš„API endpointæ˜¯çœŸå®çš„
        self.assertIn("https://openapi.alipay.com", result["output"])
        # ä¸ä¼šæ˜¯åƒ "https://api.fake-alipay.com" è¿™æ ·çš„è™šå‡URL

    def test_database_design_with_partial_inputs(self):
        """
        åœºæ™¯ï¼šæ•°æ®åº“è®¾è®¡ï¼Œåªæœ‰éƒ¨åˆ†è¾“å…¥
        éªŒè¯ï¼šAgentå…ˆåšèƒ½åšçš„éƒ¨åˆ†ï¼Œæ ‡æ³¨ä¸ç¡®å®šéƒ¨åˆ†
        """
        db_agent = DatabaseExpertAgent()

        task = "è®¾è®¡ç”µå•†æ•°æ®åº“"

        # åªæä¾›ä¸šåŠ¡è§„æ¨¡ï¼Œä¸æä¾›å•†å“å±æ€§
        inputs = {
            "business_scale": {
                "users": "1000-5000",
                "products": "10000",
            }
        }

        result = db_agent.execute(task, inputs)

        # åº”è¯¥éƒ¨åˆ†æ‰§è¡Œ
        self.assertEqual(result["status"], "PARTIALLY_COMPLETED")

        # åº”è¯¥äº§å‡ºç”¨æˆ·è¡¨ï¼ˆåŸºäºä¸šåŠ¡è§„æ¨¡ï¼‰
        self.assertIn("users", result["output"]["tables"])

        # å•†å“è¡¨åº”è¯¥æ ‡è®°ä¸ºä¸ç¡®å®š
        self.assertIn("products", result["uncertain_tables"])
```

---

## ä¸ƒã€ç›‘æ§å’Œå®¡è®¡

### 7.1 å¹»è§‰æ£€æµ‹æŒ‡æ ‡

```python
class HallucinationMonitor:
    """å¹»è§‰ç›‘æ§ç³»ç»Ÿ"""

    def calculate_hallucination_risk_score(self, agent_output):
        """
        è®¡ç®—å¹»è§‰é£é™©åˆ†æ•°

        Returns:
            {
                "risk_score": 0-100,
                "risk_level": "LOW | MEDIUM | HIGH",
                "indicators": [...]
            }
        """
        risk_score = 0
        indicators = []

        # æŒ‡æ ‡1ï¼šEXTERNALè¾“å…¥æ•°é‡ vs å£°æ˜æ•°é‡
        declared_external = count_declared_external_inputs(agent_output)
        actual_external = detect_actual_external_refs(agent_output)

        if actual_external > declared_external:
            risk_score += 30
            indicators.append(
                f"ä½¿ç”¨äº†{actual_external}ä¸ªå¤–éƒ¨å¼•ç”¨ï¼Œä½†åªå£°æ˜äº†{declared_external}ä¸ª"
            )

        # æŒ‡æ ‡2ï¼šä¸ç¡®å®šæ€§çš„æ ‡æ³¨æ•°é‡
        uncertainty_count = count_uncertainty_markers(agent_output)
        if uncertainty_count == 0:
            risk_score += 20
            indicators.append("æ²¡æœ‰æ ‡æ³¨ä»»ä½•ä¸ç¡®å®šæ€§")

        # æŒ‡æ ‡3ï¼šæ˜¯å¦åŒ…å«"å¯èƒ½"ã€"å¤§æ¦‚"ç­‰æ¨¡ç³Šè¯
        vague_words = count_vague_words(agent_output)
        if vague_words > 10:
            risk_score += 10
            indicators.append(f"åŒ…å«{vague_words}ä¸ªæ¨¡ç³Šè¯æ±‡")

        # æŒ‡æ ‡4ï¼šè¾“å‡ºä¸­æ˜¯å¦åŒ…å«çœ‹èµ·æ¥åƒå‡æ•°æ®çš„æ¨¡å¼
        fake_patterns = detect_fake_patterns(agent_output)
        if len(fake_patterns) > 0:
            risk_score += 40
            indicators.append(f"æ£€æµ‹åˆ°{len(fake_patterns)}ä¸ªå¯èƒ½çš„è™šæ„æ•°æ®æ¨¡å¼")

        # è®¡ç®—é£é™©ç­‰çº§
        if risk_score < 30:
            risk_level = "LOW"
        elif risk_score < 70:
            risk_level = "MEDIUM"
        else:
            risk_level = "HIGH"

        return {
            "risk_score": risk_score,
            "risk_level": risk_level,
            "indicators": indicators
        }

    def detect_fake_patterns(self, text):
        """
        æ£€æµ‹å¯èƒ½çš„è™šæ„æ•°æ®æ¨¡å¼
        """
        fake_patterns = []

        # æ¨¡å¼1ï¼šå‡çš„API endpoint
        if re.search(r'https?://api\.fake-[\w-]+\.com', text):
            fake_patterns.append("å‡çš„API endpoint")

        # æ¨¡å¼2ï¼šå‡çš„æµ‹è¯•å¯†é’¥ï¼ˆé‡å¤çš„sk_test_ï¼‰
        if text.count("sk_test_") > 3:
            fake_patterns.append("å¤§é‡å‡çš„æµ‹è¯•å¯†é’¥")

        # æ¨¡å¼3ï¼šå‡çš„é‚®ç®±ï¼ˆéƒ½æ˜¯example.comï¼‰
        example_emails = re.findall(r'[\w.]+@example\.com', text)
        if len(example_emails) > 5:
            fake_patterns.append("å¤§é‡ç¤ºä¾‹é‚®ç®±åœ°å€")

        return fake_patterns
```

### 7.2 å®¡è®¡æ—¥å¿—

```json
{
  "audit_log": {
    "timestamp": "2025-01-06T10:30:00Z",
    "agent_id": "agent_308_payment_expert",
    "task_id": "task_002_payment_integration",

    "input_declaration": {
      "declared_count": 3,
      "external_count": 3,
      "internal_count": 0,
      "validation_passed": true
    },

    "execution": {
      "status": "COMPLETED",
      "duration_seconds": 120,
      "llm_calls": 5
    },

    "output_analysis": {
      "hallucination_risk_score": 15,
      "risk_level": "LOW",
      "uncertainty_markers": 2,
      "external_references": [
        {
          "ref": "alipay_api_doc",
          "source": "EXTERNAL-VALIDATED",
          "location_in_output": "Line 45-50"
        }
      ]
    },

    "validation_result": {
      "output_valid": true,
      "warnings": [
        "Line 120: å‡è®¾ä½¿ç”¨æ²™ç®±ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒéœ€ç¡®è®¤"
      ]
    }
  }
}
```

---

## å…«ã€æœ€ä½³å®è·µæ€»ç»“

### 8.1 Agentå¼€å‘è€…æŒ‡å—

**DO âœ…**ï¼š
1. **æ˜¾å¼å£°æ˜**ï¼šæ‰€æœ‰å¤–éƒ¨è¾“å…¥å¿…é¡»æ˜ç¡®å£°æ˜
2. **ä¿å®ˆåŸåˆ™**ï¼šä¸ç¡®å®šæ—¶ï¼Œå€¾å‘äºç­‰å¾…è¾“å…¥
3. **æ ‡æ³¨æ¥æº**ï¼šäº§å‡ºä¸­æ ‡æ³¨æ¯éƒ¨åˆ†çš„ä¿¡æ¯æ¥æº
4. **éƒ¨åˆ†æ‰§è¡Œ**ï¼šå¦‚æœå¯èƒ½ï¼Œå…ˆåšç¡®å®šçš„éƒ¨åˆ†
5. **éªŒè¯è¾“å…¥**ï¼šæ”¶åˆ°è¾“å…¥åï¼Œä¸¥æ ¼éªŒè¯
6. **æ‰¿è®¤æ— çŸ¥**ï¼šä¸çŸ¥é“æ—¶è¯´ä¸çŸ¥é“ï¼Œä¸è¦çŒœæµ‹

**DON'T âŒ**ï¼š
1. **ä¸è¦ç¼–é€ **ï¼šé¡¹ç›®ç‰¹å®šä¿¡æ¯ã€ç¬¬ä¸‰æ–¹æ–‡æ¡£ã€å‡­è¯
2. **ä¸è¦å‡è®¾**ï¼šä¸šåŠ¡è§„åˆ™ã€é…ç½®å‚æ•°ã€ç”¨æˆ·åå¥½
3. **ä¸è¦çœç•¥å£°æ˜**ï¼šä»¥ä¸º"åº”è¯¥è¿™æ ·"å°±ä¸å£°æ˜
4. **ä¸è¦æ¨¡ç³Šå¤„ç†**ï¼šç”¨"å¤§æ¦‚"ã€"å¯èƒ½"æ¥æ©é¥°ä¸ç¡®å®šæ€§
5. **ä¸è¦è·³è¿‡éªŒè¯**ï¼šæ”¶åˆ°è¾“å…¥å°±ç›´æ¥ç”¨ï¼Œä¸éªŒè¯

### 8.2 ç”¨æˆ·ä½¿ç”¨æŒ‡å—

**å¦‚ä½•æä¾›è¾“å…¥**ï¼š

1. **æŸ¥çœ‹éœ€æ±‚æ¸…å•**ï¼š`workspace/required_docs/<task_id>.md`
2. **æŒ‰æ¸…å•å‡†å¤‡**ï¼šæŒ‰ç…§æ ¼å¼å’ŒéªŒè¯æ ‡å‡†å‡†å¤‡æ–‡ä»¶
3. **æäº¤è¾“å…¥**ï¼šæ”¾åˆ°æŒ‡å®šä½ç½®
4. **æŸ¥çœ‹éªŒè¯ç»“æœ**ï¼šç³»ç»Ÿä¼šéªŒè¯å¹¶æŠ¥å‘Šé—®é¢˜
5. **æ ¹æ®åé¦ˆä¿®æ­£**ï¼šå¦‚æœéªŒè¯å¤±è´¥ï¼ŒæŒ‰å»ºè®®ä¿®æ­£

**å¦‚ä½•åˆ¤æ–­Agentæ˜¯å¦é è°±**ï¼š

1. **æŸ¥çœ‹ä¿¡æ¯æ¥æºå£°æ˜**ï¼šâœ… INTERNAL å¤š â†’ å¯é 
2. **æŸ¥çœ‹ä¸ç¡®å®šæ€§æŠ¥å‘Š**ï¼šâ“ ASSUMED å¤š â†’ éœ€è¦ç¡®è®¤
3. **æŸ¥çœ‹å¹»è§‰é£é™©åˆ†æ•°**ï¼šLOW â†’ å¯ä»¥ä¿¡ä»»ï¼ŒHIGH â†’ éœ€è¦äººå·¥å®¡æŸ¥
4. **æŸ¥çœ‹éªŒè¯æ—¥å¿—**ï¼šéªŒè¯é€šè¿‡ â†’ å¯é ï¼ŒéªŒè¯å¤±è´¥ â†’ éœ€è¦ä¿®æ­£

---

## ä¹ã€æ€»ç»“

### æ ¸å¿ƒæœºåˆ¶å›é¡¾

| æœºåˆ¶ | ç›®æ ‡ | å®ç°æ–¹å¼ |
|------|------|---------|
| **è¾“å…¥éœ€æ±‚å£°æ˜** | æ˜ç¡®éœ€è¦ä»€ä¹ˆè¾“å…¥ | `source`å­—æ®µæ ‡æ³¨INTERNAL/EXTERNAL |
| **åˆ†ç±»å†³ç­–æ ‘** | åˆ¤æ–­æ˜¯ç”Ÿæˆè¿˜æ˜¯ç­‰å¾… | 4å±‚åˆ¤æ–­é€»è¾‘ |
| **ä¸¥æ ¼æç¤ºè¯** | çº¦æŸAgentè¡Œä¸º | åå¹»è§‰çº¦æŸæŒ‡ä»¤ |
| **è¾“å…¥éªŒè¯** | ç¡®ä¿è¾“å…¥çœŸå® | æ ¼å¼ã€å®Œæ•´æ€§ã€ä¸€è‡´æ€§éªŒè¯ |
| **è¾“å‡ºæ ‡æ³¨** | æ ‡æ³¨ä¿¡æ¯æ¥æº | âœ…âš ï¸â“ æ ‡è®°ç³»ç»Ÿ |
| **ä¸ç¡®å®šæ€§å®¹å¿** | å…è®¸éƒ¨åˆ†æ‰§è¡Œ | uncertainty_report |
| **å¹»è§‰ç›‘æ§** | æ£€æµ‹å¼‚å¸¸è¡Œä¸º | risk_scoreè®¡ç®— |

### å…³é”®åŸåˆ™

> **"ä¸çŸ¥é“å°±è¯´ä¸çŸ¥é“ï¼Œä¸è¦çŒœæµ‹"**
>
> **"é¡¹ç›®ç‰¹å®šä¿¡æ¯å¿…é¡»ä»å¤–éƒ¨è·å–ï¼Œä¸èƒ½ç¼–é€ "**
>
> **"äº§å‡ºå¿…é¡»æ ‡æ³¨ä¿¡æ¯æ¥æºï¼Œè®©ç”¨æˆ·çŸ¥é“èƒ½ä¿¡å¤šå°‘"**

### ä¸å…¶ä»–æœºåˆ¶çš„ååŒ

- **ä¸ä»»åŠ¡é˜»å¡æœºåˆ¶é…åˆ**ï¼šEXTERNALè¾“å…¥ç¼ºå¤± â†’ BLOCKED_WAITING_INPUT
- **ä¸çŸ¥è¯†åº“é…åˆ**ï¼šçŸ¥è¯†åº“ä¸­çš„ä¿¡æ¯ â†’ EXTERNAL-VALIDATED
- **ä¸ä¼šè®®æœºåˆ¶é…åˆ**ï¼šä¼šè®®ä¸­è¯†åˆ«éœ€è¦EXTERNALè¾“å…¥ â†’ ä¼šè®®ç»“è®ºä¸­å£°æ˜

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-06
**çŠ¶æ€**ï¼šâœ… é˜²å¹»è§‰æœºåˆ¶è®¾è®¡å®Œæˆï¼Œå¯è¿›å…¥å®ç°é˜¶æ®µ
